{{left_sidebar_enabled,right_sidebar_enabled=False,('message' in globals())}}
{{extend 'layout.html'}}
{{if 'itemview' in globals():}}
<div class="panel panel-default">
    <div class="panel-heading">
        <a class="button btn btn-default" href="{{
            =url(function, itemview.record.id, 'e')}}">Edit</a>
        <a href="{{=url(function)}}">View all objects</a>
    </div>
    <table class="table">
        {{for column in itemview.table:
            if column.readable:}}<tr>
            <td><label>{{=column.name}}</label></td>
            <td>{{=display(column, itemview.record,
                           primary_reference=False)}}</td>
        </tr>{{pass}}{{pass}}
    </table>
</div>
{{for field in itemview.table._extra['related']:}}{{=H3(field)}}{{=db(field == itemview.record.id).select() or 'No records'}}{{pass}}
{{related_lists = itemview.table._extra['related']}}
{{related_lists = []}}
{{pass}}
{{if 'listview' in globals():}}{{related_lists = [listview]}}
{{elif 'related_lists' not in globals():}}{{related_lists = []}}{{pass}}
{{for listview in related_lists:}}
{{has_primary = ('primary' in listview.table._extra and
                 any(primary in listview.names for primary in listview.table._extra['primary']))}}
<div class="panel panel-default">
    <div class="panel-heading">{{=listview.title}}
        <a class="button btn-sm btn-default" href="{{=listview.new_url()}}">New</a></div>
    <table class="table" style="table-layout: fixed;">
        <colgroup>
            <col style="width:{{=7.5 if has_primary else 11}}em;">
        </colgroup>
        <tr>{{for header in listview.headers():}}
            <th>{{=header}}</th>{{pass}}
        </tr>
        {{for row in listview.rows():}}<tr>
            {{for column in listview.columns():}}<td>{{if column.name == 'id':}}
            {{if not has_primary:}}
            <a class="btn btn-xs btn-default" href="{{=listview.view_url(row.id)}}">View</a>{{pass}}
            <a class="btn btn-xs btn-default" href="{{=listview.edit_url(row.id)}}">Edit</a>
            <a class="btn btn-xs btn-default" href="{{=listview.delete_url(row.id)}}">Delete</a>{{else:}}
            {{=display(column, row)}}{{pass}}</td>{{pass}}
        </tr>{{pass}}
    </table>
</div>
{{pass}}
{{if 'form' in globals():}}
{{=form}}
{{pass}}

{{block right_sidebar}}
{{end}}
